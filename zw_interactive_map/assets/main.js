//SIVECO
mapboxgl.accessToken = 'pk.eyJ1IjoianVsaWV0dGVsYXQiLCJhIjoiY2szNDFleWJzMHNjOTNtczJrc3pwMjR5bCJ9.IvgBC4cXDgWfBYunhdqh5w';

//current teams affectations geojson file
  var current_factories = {
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.46742,22.339452 ]
    },
    "properties": {
    "nid":"197389",
    "team_nid":"197428",
    "team_indice":6,
    "work_capacity":40204,
    "address":"三乡万象郡花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.210212,22.642108 ]
    },
    "properties": {
    "nid":"197386",
    "team_nid":"197425",
    "team_indice":5,
    "work_capacity":44854,
    "address":"古镇富都花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.214201,22.649341 ]
    },
    "properties": {
    "nid":"197387",
    "team_nid":"197425",
    "team_indice":5,
    "work_capacity":25,
    "address":"古镇盛世嘉元泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.261396,22.711603 ]
    },
    "properties": {
    "nid":"197384",
    "team_nid":"197424",
    "team_indice":4,
    "work_capacity":17918,
    "address":"东凤万科金色家园二期二标段泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.258406,22.688569 ]
    },
    "properties": {
    "nid":"197385",
    "team_nid":"197424",
    "team_indice":4,
    "work_capacity":8959,
    "address":"东凤上水湾二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.304946,22.616003 ]
    },
    "properties": {
    "nid":"197382",
    "team_nid":"197423",
    "team_indice":3,
    "work_capacity":47281,
    "address":"东升君汇尚品一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.303676,22.617108 ]
    },
    "properties": {
    "nid":"197383",
    "team_nid":"197423",
    "team_indice":3,
    "work_capacity":2290,
    "address":"东升君汇尚品二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.32456,22.420834 ]
    },
    "properties": {
    "nid":"197381",
    "team_nid":"197422",
    "team_indice":2,
    "work_capacity":19725,
    "address":"板芙祥畔华庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.331531,22.393117 ]
    },
    "properties": {
    "nid":"249934",
    "team_nid":"197422",
    "team_indice":2,
    "work_capacity":3900,
    "address":"板芙纯水岸泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.37008,22.509586 ]
    },
    "properties": {
    "nid":"197362",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":600,
    "address":"石歧区利和豪庭一区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "nid":"197363",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":2790,
    "address":"石歧区中海锦城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.397331,22.541959 ]
    },
    "properties": {
    "nid":"197364",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":20,
    "address":"石歧区雅尚花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.42157,22.520277 ]
    },
    "properties": {
    "nid":"197365",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":0,
    "address":"东区紫岭国际一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.413154,22.522315 ]
    },
    "properties": {
    "nid":"197366",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":0,
    "address":"东区奕翠园4C-1泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.412912,22.532338 ]
    },
    "properties": {
    "nid":"197367",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":570,
    "address":"东区比华利泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.426321,22.52564 ]
    },
    "properties": {
    "nid":"197368",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":3720,
    "address":"东区天奕国际泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43696,22.513043 ]
    },
    "properties": {
    "nid":"197369",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":2640,
    "address":"东区品峰花园一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.439423,22.513377 ]
    },
    "properties": {
    "nid":"197370",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":880,
    "address":"东区品峰花园二三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.354422,22.515466 ]
    },
    "properties": {
    "nid":"197371",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":12960,
    "address":"西区剑桥郡A03区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.353492,22.517992 ]
    },
    "properties": {
    "nid":"197372",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":480,
    "address":"西区剑桥郡A05区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.356932,22.546358 ]
    },
    "properties": {
    "nid":"197373",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":45,
    "address":"西区棕榈彩虹泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.361458,22.541661 ]
    },
    "properties": {
    "nid":"197374",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":7740,
    "address":"西区御水湾泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375505,22.501189 ]
    },
    "properties": {
    "nid":"197375",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":2580,
    "address":"南区恒大绿洲二三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370533,22.493307 ]
    },
    "properties": {
    "nid":"197376",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":26160,
    "address":"南区悦盈新城三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.366524,22.487747 ]
    },
    "properties": {
    "nid":"197377",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":27960,
    "address":"南区星汇云锦三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.367099,22.478767 ]
    },
    "properties": {
    "nid":"197378",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":13950,
    "address":"南区锦锈蓝山泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.458969,22.5176 ]
    },
    "properties": {
    "nid":"197379",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":8940,
    "address":"火炬开发区万科柏悦湾二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.440958,22.525391 ]
    },
    "properties": {
    "nid":"197380",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":4470,
    "address":"火炬开发区德宝怡高泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.403992,22.553931 ]
    },
    "properties": {
    "nid":"330926",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":52020,
    "address":"石歧区时代云图泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.369689,22.551344 ]
    },
    "properties": {
    "nid":"330927",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":6735,
    "address":"石歧区幸福汇泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.399608,22.536482 ]
    },
    "properties": {
    "nid":"330928",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":600,
    "address":"石歧区溢彩家园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.402147,22.544501 ]
    },
    "properties": {
    "nid":"330929",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":810,
    "address":"石歧区悦享星醍泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376396,22.55201 ]
    },
    "properties": {
    "nid":"330931",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":120,
    "address":"石歧区时尚荟三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370426,22.513229 ]
    },
    "properties": {
    "nid":"330935",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":960,
    "address":"石岐区欧雅豪庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375164,22.509915 ]
    },
    "properties": {
    "nid":"330936",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":55800,
    "address":"石岐区蓝钻双子座泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370296,22.549457 ]
    },
    "properties": {
    "nid":"330937",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":5,
    "address":"石岐区宜君汇名苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416794,22.527527 ]
    },
    "properties": {
    "nid":"330938",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":180,
    "address":"东区和美顺府泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376439,22.503142 ]
    },
    "properties": {
    "nid":"330939",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":242,
    "address":"东区映翠豪庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416199,22.506047 ]
    },
    "properties": {
    "nid":"330942",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":12422,
    "address":"东区帝璟东方泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40724,22.542584 ]
    },
    "properties": {
    "nid":"330945",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":4662,
    "address":"东区加和领御名苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40762,22.547184 ]
    },
    "properties": {
    "nid":"330946",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":24715,
    "address":"东区上品花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.411437,22.540141 ]
    },
    "properties": {
    "nid":"330947",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":20177,
    "address":"东区花样四季泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.377756,22.505842 ]
    },
    "properties": {
    "nid":"330948",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":17280,
    "address":"东区幸福天地泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368723,22.540675 ]
    },
    "properties": {
    "nid":"330949",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":813,
    "address":"西区滨江公馆泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355869,22.541343 ]
    },
    "properties": {
    "nid":"330952",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":25296,
    "address":"西区水悦馨园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.358295,22.539625 ]
    },
    "properties": {
    "nid":"330958",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":150,
    "address":"西区水悦熙园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355119,22.543449 ]
    },
    "properties": {
    "nid":"330959",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":17753,
    "address":"西区优格国际一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370254,22.54625 ]
    },
    "properties": {
    "nid":"330960",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":57394,
    "address":"西区花海湾一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.365758,22.490336 ]
    },
    "properties": {
    "nid":"330963",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":39308,
    "address":"南区永安新城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.373629,22.496089 ]
    },
    "properties": {
    "nid":"330965",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":24017,
    "address":"南区悦盈新城一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374666,22.499024 ]
    },
    "properties": {
    "nid":"330966",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":14280,
    "address":"南区祈安苑三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.352,22.4584 ]
    },
    "properties": {
    "nid":"330970",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":27129,
    "address":"南区新光天地一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43494,22.535997 ]
    },
    "properties": {
    "nid":"330974",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":67609,
    "address":"火炬区尚城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "nid":"330975",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":0,
    "address":"火炬区合生帝景苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.450846,22.51568 ]
    },
    "properties": {
    "nid":"330978",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":17785,
    "address":"火炬区聚豪园西苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375794,22.55114 ]
    },
    "properties": {
    "nid":"367083",
    "team_nid":"197421",
    "team_indice":1,
    "work_capacity":45022,
    "address":"石歧区时尚荟二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375991,22.544239 ]
    },
    "properties": {
    "nid":"330932",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":1500,
    "address":"石歧区金域蓝湾一期一标泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.4336,22.50519 ]
    },
    "properties": {
    "nid":"330940",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":45,
    "address":"东区远洋天曜4幢泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.435854,22.504831 ]
    },
    "properties": {
    "nid":"330941",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":120,
    "address":"东区远洋天曜19幢泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43323,22.508342 ]
    },
    "properties": {
    "nid":"330944",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":7800,
    "address":"东区御峰臻品泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375843,22.554129 ]
    },
    "properties": {
    "nid":"330950",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":2310,
    "address":"西区美林春天一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374591,22.553853 ]
    },
    "properties": {
    "nid":"330951",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":115,
    "address":"西区美林春天四期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.364614,22.549125 ]
    },
    "properties": {
    "nid":"330953",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":510,
    "address":"西区沁美家园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "nid":"330957",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":3990,
    "address":"西区万好美居泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.357301,22.485119 ]
    },
    "properties": {
    "nid":"330962",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":0,
    "address":"南区华俊翠苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371193,22.506306 ]
    },
    "properties": {
    "nid":"330967",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":180,
    "address":"南区滨河湾一二三四期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362174,22.500012 ]
    },
    "properties": {
    "nid":"330969",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":120,
    "address":"南区金水湾泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.360234,22.492065 ]
    },
    "properties": {
    "nid":"330971",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":5,
    "address":"南区博贸大厦泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368328,22.505713 ]
    },
    "properties": {
    "nid":"330973",
    "team_nid":"0",
    "team_indice":0,
    "work_capacity":60,
    "address":"南区滨河湾五六七期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.39842,22.51444 ]
    },
    "properties": {
    "nid":"origin",
    "team_nid":"all",
    "team_indice":0,
    "work_capacity":0,
    "address":"unknown"
    }
  }
]
};
//end of geojson file

//algo teams affectations geojson file
  var algo_factories = {
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.46742,22.339452 ]
    },
    "properties": {
    "team_indice":8,
    "nid":"197389",
    "work_capacity":4423,
    "address":"三乡万象郡花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.366524,22.487747 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"197377",
    "work_capacity":17909,
    "address":"南区星汇云锦三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.32456,22.420834 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"197381",
    "work_capacity":17909,
    "address":"板芙祥畔华庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.331531,22.393117 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"249934",
    "work_capacity":17909,
    "address":"板芙纯水岸泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375164,22.509915 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"330936",
    "work_capacity":17909,
    "address":"石岐区蓝钻双子座泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.365758,22.490336 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"330963",
    "work_capacity":17909,
    "address":"南区永安新城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.352,22.4584 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"330970",
    "work_capacity":17909,
    "address":"南区新光天地一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368328,22.505713 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"330973",
    "work_capacity":17909,
    "address":"南区滨河湾五六七期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43494,22.535997 ]
    },
    "properties": {
    "team_indice":7,
    "nid":"330974",
    "work_capacity":17909,
    "address":"火炬区尚城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197363",
    "work_capacity":15405,
    "address":"石歧区中海锦城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.304946,22.616003 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197382",
    "work_capacity":15405,
    "address":"东升君汇尚品一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.303676,22.617108 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197383",
    "work_capacity":15405,
    "address":"东升君汇尚品二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.261396,22.711603 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197384",
    "work_capacity":15405,
    "address":"东凤万科金色家园二期二标段泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.258406,22.688569 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197385",
    "work_capacity":15405,
    "address":"东凤上水湾二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.210212,22.642108 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197386",
    "work_capacity":15405,
    "address":"古镇富都花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.214201,22.649341 ]
    },
    "properties": {
    "team_indice":6,
    "nid":"197387",
    "work_capacity":15405,
    "address":"古镇盛世嘉元泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"197363",
    "work_capacity":17728,
    "address":"石歧区中海锦城泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.397331,22.541959 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"197364",
    "work_capacity":17728,
    "address":"石歧区雅尚花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.403992,22.553931 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330926",
    "work_capacity":17728,
    "address":"石歧区时代云图泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.399608,22.536482 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330928",
    "work_capacity":17728,
    "address":"石歧区溢彩家园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.402147,22.544501 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330929",
    "work_capacity":17728,
    "address":"石歧区悦享星醍泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40724,22.542584 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330945",
    "work_capacity":17728,
    "address":"东区加和领御名苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40762,22.547184 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330946",
    "work_capacity":17728,
    "address":"东区上品花园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.411437,22.540141 ]
    },
    "properties": {
    "team_indice":5,
    "nid":"330947",
    "work_capacity":17728,
    "address":"东区花样四季泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.356932,22.546358 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"197373",
    "work_capacity":17898,
    "address":"西区棕榈彩虹泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376396,22.55201 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330931",
    "work_capacity":17898,
    "address":"石歧区时尚荟三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375991,22.544239 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330932",
    "work_capacity":17898,
    "address":"石歧区金域蓝湾一期一标泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368723,22.540675 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330949",
    "work_capacity":17898,
    "address":"西区滨江公馆泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375843,22.554129 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330950",
    "work_capacity":17898,
    "address":"西区美林春天一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374591,22.553853 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330951",
    "work_capacity":17898,
    "address":"西区美林春天四期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355869,22.541343 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330952",
    "work_capacity":17898,
    "address":"西区水悦馨园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.364614,22.549125 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330953",
    "work_capacity":17898,
    "address":"西区沁美家园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355119,22.543449 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330959",
    "work_capacity":17898,
    "address":"西区优格国际一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370254,22.54625 ]
    },
    "properties": {
    "team_indice":4,
    "nid":"330960",
    "work_capacity":17898,
    "address":"西区花海湾一二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.354422,22.515466 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"197371",
    "work_capacity":17985,
    "address":"西区剑桥郡A03区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.353492,22.517992 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"197372",
    "work_capacity":17985,
    "address":"西区剑桥郡A05区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.361458,22.541661 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"197374",
    "work_capacity":17985,
    "address":"西区御水湾泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.369689,22.551344 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"330927",
    "work_capacity":17985,
    "address":"石歧区幸福汇泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370426,22.513229 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"330935",
    "work_capacity":17985,
    "address":"石岐区欧雅豪庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370296,22.549457 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"330937",
    "work_capacity":17985,
    "address":"石岐区宜君汇名苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"330957",
    "work_capacity":17985,
    "address":"西区万好美居泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.358295,22.539625 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"330958",
    "work_capacity":17985,
    "address":"西区水悦熙园泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375794,22.55114 ]
    },
    "properties": {
    "team_indice":3,
    "nid":"367083",
    "work_capacity":17985,
    "address":"石歧区时尚荟二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.37008,22.509586 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"197362",
    "work_capacity":17728,
    "address":"石歧区利和豪庭一区泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375505,22.501189 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"197375",
    "work_capacity":17728,
    "address":"南区恒大绿洲二三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.367099,22.478767 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"197378",
    "work_capacity":17728,
    "address":"南区锦锈蓝山泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376439,22.503142 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330939",
    "work_capacity":17728,
    "address":"东区映翠豪庭泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.377756,22.505842 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330948",
    "work_capacity":17728,
    "address":"东区幸福天地泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330957",
    "work_capacity":17728,
    "address":"西区万好美居泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.373629,22.496089 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330965",
    "work_capacity":17728,
    "address":"南区悦盈新城一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374666,22.499024 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330966",
    "work_capacity":17728,
    "address":"南区祈安苑三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371193,22.506306 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330967",
    "work_capacity":17728,
    "address":"南区滨河湾一二三四期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362174,22.500012 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330969",
    "work_capacity":17728,
    "address":"南区金水湾泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.360234,22.492065 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330971",
    "work_capacity":17728,
    "address":"南区博贸大厦泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "team_indice":2,
    "nid":"330975",
    "work_capacity":17728,
    "address":"火炬区合生帝景苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.42157,22.520277 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197365",
    "work_capacity":17957,
    "address":"东区紫岭国际一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.413154,22.522315 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197366",
    "work_capacity":17957,
    "address":"东区奕翠园4C-1泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.412912,22.532338 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197367",
    "work_capacity":17957,
    "address":"东区比华利泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.426321,22.52564 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197368",
    "work_capacity":17957,
    "address":"东区天奕国际泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43696,22.513043 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197369",
    "work_capacity":17957,
    "address":"东区品峰花园一期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.439423,22.513377 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197370",
    "work_capacity":17957,
    "address":"东区品峰花园二三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370533,22.493307 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197376",
    "work_capacity":17957,
    "address":"南区悦盈新城三期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.458969,22.5176 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197379",
    "work_capacity":17957,
    "address":"火炬开发区万科柏悦湾二期泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.440958,22.525391 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"197380",
    "work_capacity":17957,
    "address":"火炬开发区德宝怡高泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416794,22.527527 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330938",
    "work_capacity":17957,
    "address":"东区和美顺府泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.4336,22.50519 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330940",
    "work_capacity":17957,
    "address":"东区远洋天曜4幢泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.435854,22.504831 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330941",
    "work_capacity":17957,
    "address":"东区远洋天曜19幢泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416199,22.506047 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330942",
    "work_capacity":17957,
    "address":"东区帝璟东方泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43323,22.508342 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330944",
    "work_capacity":17957,
    "address":"东区御峰臻品泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.357301,22.485119 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330962",
    "work_capacity":17957,
    "address":"南区华俊翠苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330975",
    "work_capacity":17957,
    "address":"火炬区合生帝景苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.450846,22.51568 ]
    },
    "properties": {
    "team_indice":1,
    "nid":"330978",
    "work_capacity":17957,
    "address":"火炬区聚豪园西苑泵房"
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.39842,22.51444 ]
    },
    "properties": {
    "team_indice":0,
    "nid":"origin",
    "work_capacity":0,
    "address":"unknown"
    }
  }
]
};
//end of geojson file

//determines colors attributed to teams
teams_colors = {"0": "#b387d8",
"1": "#5d90d2",
"2": "#605cdb",
"3": "#a748d3",
"4": "#4fcba1",
"5": "#47bfd4",
"6": "#3f9f84",
"7": "#6958a2",
"8": "#277257"
};

//displays mapbox map
var map = new mapboxgl.Map({  
container: 'map', 
style: 'mapbox://styles/juliettelat/ck3pf0oj06p9l1crutxskznmt',
center: [113.32374,22.542012], 
zoom: 9.8
});


///////////////DATASET SELECTION/////////////////////////////////////////////////////////////////////////////////////
  map.on ('load', function () {
    var factories = current_factories;
     map.addSource('factories', {
        "type": "geojson",
        "data": factories
    });

    var button_current = document.getElementById('button-current');
    button_current.addEventListener('click', function () {
      button_algo.style.background = 'rgba(255, 255, 255, 0.6)';
      button_current.style.background = 'rgba(255, 255, 255, 0.8)';
      factInfo.style.display = "none";
      teamInfo.style.display = "none";
      map.removeLayer('factories');
      map.removeLayer('factories-highlighted');
      map.removeLayer('unique-factory');
      map.removeSource('factories');
      var factories = current_factories;
      console.log(factories);
      map.addSource('factories', {
        "type": "geojson",
        "data": factories
      });
///////////////MAP LAYERS////////////////////
      map.addLayer({
        'id':'factories',
        'type': 'circle',
        'source': 'factories',
        'paint': {
          // make circles larger as the user zooms from z12 to z22
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 3], [12, 4], [14, 6], [16, 8], [18, 12]]
          },
          'circle-color': 'rgba(170, 170, 170, 0.6)',
        }
      },
      );
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'factories-highlighted',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color':[
          'step',
          ['get', 'team_indice'],
          '#ccc',
          0,
          teams_colors["0"],
          1,
          teams_colors["1"],
          2,
          teams_colors["2"],
          3,
          teams_colors["3"],
          4,
          teams_colors["4"],
          5,
          teams_colors["5"],
          6,
          teams_colors["6"],
          7,
          teams_colors["7"],
          8,
          teams_colors["8"]
          ] 


        },
        'filter': ['in', 'team_indice', '']
      });
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'unique-factory',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color': 'rgba(255,255,255,1)',   
        },
        'filter': ['in', 'nid', '']
      });
      map.setFilter ('factories-highlighted', ['has', 'nid']);
    });
    
    var button_algo = document.getElementById('button-algo');
    button_algo.addEventListener('click', function () {
      button_current.style.background = 'rgba(255, 255, 255, 0.6)';
      button_algo.style.background = 'rgba(255, 255, 255, 0.8)';
      factInfo.style.display = "none";
      teamInfo.style.display = "none";
      map.removeLayer('factories');
      map.removeLayer('factories-highlighted');
      map.removeLayer('unique-factory');
      map.removeSource('factories');
      var factories = algo_factories;
      map.addSource('factories', {
        "type": "geojson",
        "data": factories
      });
///////////////MAP LAYERS///////////////////
      map.addLayer({
        'id':'factories',
        'type': 'circle',
        'source': 'factories',
        'paint': {
          // make circles larger as the user zooms from z12 to z22
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 3], [12, 4], [14, 6], [16, 8], [18, 12]]
          },
          'circle-color': 'rgba(170, 170, 170, 0.6)',
        }
      },
      );
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'factories-highlighted',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color': [
          'step',
          ['get', 'team_indice'],
          '#ccc',
          0,
          teams_colors["0"],
          1,
          teams_colors["1"],
          2,
          teams_colors["2"],
          3,
          teams_colors["3"],
          4,
          teams_colors["4"],
          5,
          teams_colors["5"],
          6,
          teams_colors["6"],
          7,
          teams_colors["7"],
          8,
          teams_colors["8"]
          ]     
        },
        'filter': ['in', 'team_indice', '']
      });
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'unique-factory',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color': 'rgba(255,255,255,1)',   
        },
        'filter': ['in', 'nid', '']
      });
      map.setFilter ('factories-highlighted', ['has', 'nid']);
    });


   

///////////////MAP LAYERS//////////////////////////////////////////////////////////////////////////////////////////
      map.addLayer({
        'id':'factories',
        'type': 'circle',
        'source': 'factories',
        'paint': {
          // make circles larger as the user zooms from z12 to z22
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 3], [12, 4], [14, 6], [16, 8], [18, 12]]
          },
          'circle-color': 'rgba(100,100,100,0.5)',
        }
      },
      );
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'factories-highlighted',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color': [
          'step',
          ['get', 'team_indice'],
          '#ccc',
          0,
          teams_colors["0"],
          1,
          teams_colors["1"],
          2,
          teams_colors["2"],
          3,
          teams_colors["3"],
          4,
          teams_colors["4"],
          5,
          teams_colors["5"],
          6,
          teams_colors["6"],
          7,
          teams_colors["7"],
          8,
          teams_colors["8"]
          ]   
        },
        'filter': ['==', 'team_indice', '']
      });
      //adds a layer that displays highlighted factories when a factory is clicked
      map.addLayer({
        'id': 'unique-factory',
        'type': 'circle',
        'source': 'factories',
        'paint':{
          'circle-radius': {
          'base': 0,
          'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
          },
          'circle-color': 'rgba(255,255,255,1)',   
        },
        'filter': ['in', 'nid', ''],
      });
      map.setFilter ('factories-highlighted', ['has', 'nid']);
///////////////INTERACTIVE MAP/////////////////////////////////////////////////////////////////////////////////////
    //highlights factories that are visited by the same teams than the clicked point on the map
    map.on('click', 'factories', function(e) {
      menuFact.style.display = "none"; //removes factories list
      menuFactTitle.style.display = "none";
      var feature = e.features[0];
      //actualizes the unique-factory filter
      map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
      map.setFilter ('unique-factory', ['in', 'nid', feature.properties.nid]); //refill filter
      //actualizes the factories-highlighted filter
      map.setFilter('factories-highlighted', ['in', 'team_indice', '']); //empty filter
      var featuresgroup = map.querySourceFeatures ('factories', {  
        sourceLayer: 'factories',
        filter: ['in', 'nid', feature.properties.nid]
      }); //creates an array with all factories with same nid (features of the same factory visited by several teams)
      var filter = featuresgroup.reduce(
        function(memo, feature) {
        memo.push(feature.properties.team_indice);
        return memo;
        }, //creates a group with all the factories visited by the same teams as the factory selected
      ['in', 'team_indice']
      );
      map.setFilter('factories-highlighted', filter); //refill filter
      teamInfo.style.display = "block";
      displayTeamInfoFromMap(feature);
      factInfo.style.display = "block";
      displayFactoryInfo (feature);
    });

    map.on('mouseleave', 'factories', function() {
      map.getCanvas().style.cursor = '';
    });

    map.on('mousemove', 'factories', function() {
      map.getCanvas().style.cursor = 'pointer';
    });
 
  ///////////////INTERACTIVE LIST///////////////////////////////////////////////////////////////////////////////////// 
  var listingEl = document.getElementById('teams-listing');
  var listingFact = document.getElementById('factories-listing');
  var menuFact = document.getElementsByClassName('factories-menu')[0];
  var menuFactTitle = document.getElementById('factories-list-title');  
  var teamInfo = document.getElementById('team-info');
  var factInfo = document.getElementById('fact-info'); 
  function renderListings (features) {
    //DISPLAYS TEAM LIST
    listingEl.innerHTML = ''; //clear team list
    if (features.length) {
      var i;
      var rank = features.length - 1;
      var imax = features[rank].properties.team_indice; //puts the number of teams in the dataset in the variable imax
      for (i = 0; i <= imax; i++) { //diplays the list
        if (i == 0) {
          var item = document.createElement('a');
              item.textContent = 'No affectation 0';   
          listingEl.appendChild(item);       
        }
        else {
          var item = document.createElement('a');
              item.textContent = 'Team ' + i;
          listingEl.appendChild(item);
        }
        item.addEventListener('click', function renderListings () {
          //DISPLAYS HIGLIGHTED DOTS ON THE MAP WHEN TEAM LIST IS CLICKED ON
            factInfo.style.display = "none";
            map.setFilter('factories-highlighted', ['in', 'team_indice', '']); //empty filter
            map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
            var j = parseInt (event.target.firstChild.textContent.slice(-1),10) ; //gets the team number from the button
            map.setFilter ('factories-highlighted', ['in', 'team_indice', j]); //refill filter
            teamInfo.style.display = "block";
            displayTeamInfoFromList(features, j);
          //DISPLAYS THE FACTORIES LIST WHEN A TEAM IS CLICKED ON
            menuFact.style.display = "block"; //displays html factory list background
            menuFactTitle.style.display = "block";
            listingFact.innerHTML = ''; //clear factory list
              features.forEach(function(feature) {
              if (feature.properties.team_indice == j) { //pour enlever le if, d'abord sélectionner les j, ensuite les afficher
                var itemFact = document.createElement('a');
                    itemFact.textContent = 'factory ' + feature.properties.nid;
                listingFact.appendChild(itemFact);
                itemFact.addEventListener('click', function renderListings () {
                //HIGHLIGHTS THE FACTORY ON THE MAP WHEN FACTORY LIST IS CLICKED ON
                  map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
                  map.setFilter ('unique-factory', ['in', 'nid', feature.properties.nid]); //refill filter
                  factInfo.style.display = "block";
                  displayFactoryInfo (feature);
              });
              }
            });
        });
      };
    }
  }
///////////////INFO PANEL//////////////////////////////////////////////////////////////////////////////////
    

    function displayGeneralInfo (features){
      var rank = features.length - 1;
      var imax = features[rank].properties.team_indice;
      document.getElementById('nb-of-teams').innerHTML = imax ;
      document.getElementById('nb-of-factories').innerHTML = "69" ;
      var empty_factories = map.queryRenderedFeatures ({  
        layers: ['factories'],
        filter: ['==', 'team_indice', 0]
      });
      document.getElementById('nb-of-unvisited-factories').innerHTML = empty_factories.length-1 ;
      var total_work_load = 0;
      features.forEach (function (feature){
        total_work_load = total_work_load + feature.properties.work_capacity;
      });
      document.getElementById('total-working-load').innerHTML = total_work_load;
    };

    function displayTeamInfoFromList(features, j){
      var selected_team = map.queryRenderedFeatures ({  
        layers: ['factories'],
        filter: ['==', 'team_indice', j]
      });
      document.getElementById('team-nid').innerHTML = selected_team[0].properties.team_nid ;
      var team_working_load = 0;
      selected_team.forEach(function (feature){
        team_working_load = team_working_load + feature.properties.work_capacity;
      });
      document.getElementById('total-team-working-load').innerHTML = team_working_load ;
    };

    function displayTeamInfoFromMap(feature){
      if (feature.properties.team_nid == 0) {
        document.getElementById('team-nid').innerHTML = "This set of factory is not assigned"
      }
      else {document.getElementById('team-nid').innerHTML = feature.properties.team_nid ;
      }
      var patrol = map.queryRenderedFeatures ({  
        layers: ['factories'],
        filter: ['==', 'team_indice', feature.properties.team_indice]
      });    
      var team_working_load = 0;
      patrol.forEach (function (feature){
        team_working_load = team_working_load + feature.properties.work_capacity;
      });
      document.getElementById('total-team-working-load').innerHTML = team_working_load ;
    };

    function displayFactoryInfo (feature){
      document.getElementById('nid').innerHTML = feature.properties.nid;
      document.getElementById('address').innerHTML = feature.properties.address ;
      var entire_factory = map.queryRenderedFeatures ({  
        layers: ['factories'],
        filter: ['==', 'nid', feature.properties.nid]
      });      
      document.getElementById('nb-of-teams-visiting').innerHTML = entire_factory.length ;
      document.getElementById('visiting-team-nid').innerHTML = feature.properties.team_nid ; 
      var inner_working_load = 0;
      entire_factory.forEach (function (feature){
        inner_working_load = inner_working_load + feature.properties.work_capacity;
      });
      document.getElementById('inner-working-load').innerHTML = inner_working_load ;
      var newp = document.getElementById('fact-team-working-load')
          newp.innerHTML = '';
      entire_factory.forEach( function(feature){
        var item = document.createElement('p');
            item.textContent = feature.properties.work_capacity;
            newp.appendChild(item);
      }); 
    }

    map.on('click', function() {
      menuFact.style.display = "none"; //removes factories list
      menuFactTitle.style.display = "none";
      var features = map.queryRenderedFeatures({ layers: ['factories'] });
      //Populate features for the listing overlay.
      renderListings(features);
      displayGeneralInfo (features);
    });
  });



